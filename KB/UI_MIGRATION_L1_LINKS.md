# ะะธะณัะฐัะธั UI: ะะตัะตัะพะด ั l1_deps ะฝะฐ l1_in + l1_out

## ะะฑะทะพั ะธะทะผะตะฝะตะฝะธะน

API ัะตะฟะตัั ะฒะพะทะฒัะฐัะฐะตั ัะฒัะทะธ L1 ะฒ ะฝะพะฒะพะผ ัะพัะผะฐัะต ั ัะธะฟะฐะผะธ:
- **ะัะปะพ**: `l1_deps: string[]` โ ะผะฐััะธะฒ ะทะฐะฒะธัะธะผะพััะตะน
- **ะกัะฐะปะพ**: `l1_in: L1LinkIn[]` + `l1_out: L1Link[]` โ ัะฐะทะดะตะปะตะฝะธะต ะฟะพ ะฝะฐะฟัะฐะฒะปะตะฝะธั ั ัะธะฟะฐะผะธ ัะฒัะทะตะน

---

## ะะทะผะตะฝะตะฝะธั ะฒ API ะพัะฒะตัะฐั

### ะกัะตะผะฐ AiItem

| ะะพะปะต | ะขะธะฟ | ะะฟะธัะฐะฝะธะต |
|------|-----|----------|
| `l1_in` | `L1LinkIn[]` | ะัะพะดััะธะต ัะฒัะทะธ: ะบัะพ ะฒัะทัะฒะฐะตั/ะธัะฟะพะปัะทัะตั ััะพั ัะปะตะผะตะฝั (ั ัะธะฟะพะผ) |
| `l1_out` | `L1Link[]` | ะััะพะดััะธะต ัะฒัะทะธ: ััะพ ะฒัะทัะฒะฐะตั/ะธัะฟะพะปัะทัะตั ััะพั ัะปะตะผะตะฝั (ั ัะธะฟะพะผ) |

### ะขะธะฟั ัะฒัะทะตะน

| ะะพะด | ะะฟะธัะฐะฝะธะต | ะัะธะผะตั |
|-----|----------|--------|
| `calls` | ะัะทะพะฒ ััะฝะบัะธะธ | `funcA` ะฒัะทัะฒะฐะตั `funcB` |
| `reads_from` | ะงัะตะฝะธะต ะธะท ัะฐะฑะปะธัั (SELECT) | `funcA` ัะธัะฐะตั ะธะท `tableX` |
| `updates` | ะะฑะฝะพะฒะปะตะฝะธะต ัะฐะฑะปะธัั (UPDATE) | `funcA` ะพะฑะฝะพะฒะปัะตั `tableX` |
| `inserts_into` | ะััะฐะฒะบะฐ ะฒ ัะฐะฑะปะธัั (INSERT) | `funcA` ะฒััะฐะฒะปัะตั ะฒ `tableX` |
| `reads_column` | ะงัะตะฝะธะต ะบะพะปะพะฝะบะธ | `funcA` ัะธัะฐะตั `tableX.columnY` |
| `updates_column` | ะะฑะฝะพะฒะปะตะฝะธะต ะบะพะปะพะฝะบะธ | `funcA` ะพะฑะฝะพะฒะปัะตั `tableX.columnY` |
| `inserts_column` | ะััะฐะฒะบะฐ ะฒ ะบะพะปะพะฝะบั | `funcA` ะฒััะฐะฒะปัะตั ะฒ `tableX.columnY` |
| `imports` | ะะผะฟะพัั ะผะพะดัะปั | `moduleA` ะธะผะฟะพััะธััะตั `moduleB` |
| `depends_on` | ะะฑัะฐั ะทะฐะฒะธัะธะผะพััั | fallback |

### ะัะธะผะตั ะพัะฒะตัะฐ `/api/items/:id`

```json
{
  "id": "carl_auct.calcPriority",
  "type": "function",
  "language": "sql",
  "l0_code": "CREATE FUNCTION...",
  "l1_in": [
    {"source": "carl_auct.processAuction", "type": "calls"},
    {"source": "carl_auct.runBatch", "type": "calls"}
  ],
  "l1_out": [
    {"target": "carl_auct.auction", "type": "reads_from"},
    {"target": "carl_auct._getAuctObject", "type": "calls"}
  ],
  "l2_desc": "ะััะธัะปัะตั ะฟัะธะพัะธัะตั ะฐัะบัะธะพะฝะฐ",
  "filePath": "./sql/functions.sql"
}
```

---

## ะะฐะบ ะธัะฟะพะปัะทะพะฒะฐัั ะฒ UI

### 1. l1_out โ ะััะพะดััะธะต ัะฒัะทะธ

**ะกะตะผะฐะฝัะธะบะฐ**: ะญะปะตะผะตะฝั ะฒัะทัะฒะฐะตั/ัะธัะฐะตั/ะธัะฟะพะปัะทัะตั ะดััะณะธะต ัะปะตะผะตะฝัั

**ะะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ ะพัะพะฑัะฐะถะตะฝะธั**:
- **ะะบะพะฝะบะฐ**: ัััะตะปะบะฐ ะฒะฟัะฐะฒะพ โ ะธะปะธ ะธะบะพะฝะบะฐ "ะทะฐะฒะธัะธะผะพััะธ"
- **ะะพะดัะบะฐะทะบะฐ**: "ะญัะพั ัะปะตะผะตะฝั ะฒัะทัะฒะฐะตั/ัะธัะฐะตั/ะธัะฟะพะปัะทัะตั"
- **ะฆะฒะตั**: ะพะฑััะฝะพ ัะธะฝะธะน ะธะปะธ ะฝะตะนััะฐะปัะฝัะน
- **ะััะฟะฟะธัะพะฒะบะฐ**: ะผะพะถะฝะพ ะฟะพะบะฐะทะฐัั ะบะฐะบ "ะะฐะฒะธัะธะผะพััะธ" ะธะปะธ "ะัะฟะพะปัะทัะตั"

**ะัะธะผะตั ะธัะฟะพะปัะทะพะฒะฐะฝะธั**:
```typescript
// ะะพะบะฐะทะฐัั ัะฟะธัะพะบ ะทะฐะฒะธัะธะผะพััะตะน ัะปะตะผะตะฝัะฐ ั ัะธะฟะฐะผะธ
{item.l1_out.map((link, idx) => (
  <Link key={idx} to={`/items/${link.target}`}>
    โ {link.target} <Badge>{link.type}</Badge>
  </Link>
))}
```

### 2. l1_in โ ะัะพะดััะธะต ัะฒัะทะธ

**ะกะตะผะฐะฝัะธะบะฐ**: ะญะปะตะผะตะฝั ะฒัะทัะฒะฐะตััั/ะธัะฟะพะปัะทัะตััั ะดััะณะธะผะธ ัะปะตะผะตะฝัะฐะผะธ

**ะะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ ะพัะพะฑัะฐะถะตะฝะธั**:
- **ะะบะพะฝะบะฐ**: ัััะตะปะบะฐ ะฒะปะตะฒะพ โ ะธะปะธ ะธะบะพะฝะบะฐ "ะธัะฟะพะปัะทัะตััั ะฒ"
- **ะะพะดัะบะฐะทะบะฐ**: "ะญัะพั ัะปะตะผะตะฝั ะฒัะทัะฒะฐะตััั/ะธัะฟะพะปัะทัะตััั ะฒ"
- **ะฆะฒะตั**: ะพะฑััะฝะพ ะทะตะปัะฝัะน ะธะปะธ ะดััะณะพะน ะพัะปะธัะฝัะน ะพั l1_out
- **ะััะฟะฟะธัะพะฒะบะฐ**: ะผะพะถะฝะพ ะฟะพะบะฐะทะฐัั ะบะฐะบ "ะัะฟะพะปัะทัะตััั ะฒ" ะธะปะธ "ะัะทัะฒะฐะตััั ะธะท"

**ะัะธะผะตั ะธัะฟะพะปัะทะพะฒะฐะฝะธั**:
```typescript
// ะะพะบะฐะทะฐัั ัะฟะธัะพะบ ัะปะตะผะตะฝัะพะฒ, ะธัะฟะพะปัะทัััะธั ัะตะบััะธะน, ั ัะธะฟะฐะผะธ
{item.l1_in.map((link, idx) => (
  <Link key={idx} to={`/items/${link.source}`}>
    โ {link.source} <Badge>{link.type}</Badge>
  </Link>
))}
```

### 3. ะัะฐั ะทะฐะฒะธัะธะผะพััะตะน (`/api/graph`)

**ะะทะผะตะฝะตะฝะธั**:
- ะคะพัะผะฐั ะพัะฒะตัะฐ ะฝะต ะผะตะฝัะตััั (nodes + links)
- ะกะฒัะทะธ ัััะพัััั ะฝะฐ ะพัะฝะพะฒะต `l1_out` ั ัะธะฟะฐะผะธ
- Label ัะฒัะทะธ ัะตะฟะตัั ัะพะดะตัะถะธั ัะตะฐะปัะฝัะน ัะธะฟ ัะฒัะทะธ (calls, reads_from, updates ะธ ั.ะด.)

**ะัะธะผะตั ะพัะฒะตัะฐ**:
```json
{
  "nodes": [
    { "id": "func1", "type": "function", ... },
    { "id": "func2", "type": "function", ... },
    { "id": "tableX", "type": "table", ... }
  ],
  "links": [
    { "source": "func1", "target": "func2", "label": "calls" },
    { "source": "func1", "target": "tableX", "label": "reads_from" }
  ]
}
```

---

## ะะธะณัะฐัะธั ะบะพะดะฐ

### ะจะฐะณ 1: ะะฐะผะตะฝะธัั ะฒัะต ะพะฑัะฐัะตะฝะธั ะบ `l1_deps`

**ะัะปะพ**:
```typescript
const dependencies = item.l1_deps || [];
dependencies.forEach(target => console.log(target));
```

**ะกัะฐะปะพ**:
```typescript
const dependencies = item.l1_out || [];
dependencies.forEach(link => console.log(link.target, link.type));
```

### ะจะฐะณ 2: ะะพะฑะฐะฒะธัั ะพัะพะฑัะฐะถะตะฝะธะต ะฒัะพะดััะธั ัะฒัะทะตะน

**ะะพะฒัะน ะบะพะด**:
```typescript
// ะััะพะดััะธะต ัะฒัะทะธ (ะทะฐะฒะธัะธะผะพััะธ) ั ัะธะฟะฐะผะธ
{item.l1_out && item.l1_out.length > 0 && (
  <section>
    <h3>ะะฐะฒะธัะธะผะพััะธ (โ)</h3>
    {item.l1_out.map((link, idx) => (
      <Link key={idx} to={`/items/${link.target}`}>
        โ {link.target} <Badge>{link.type}</Badge>
      </Link>
    ))}
  </section>
)}

// ะัะพะดััะธะต ัะฒัะทะธ (ะธัะฟะพะปัะทัะตััั ะฒ) ั ัะธะฟะฐะผะธ
{item.l1_in && item.l1_in.length > 0 && (
  <section>
    <h3>ะัะฟะพะปัะทัะตััั ะฒ (โ)</h3>
    {item.l1_in.map((link, idx) => (
      <Link key={idx} to={`/items/${link.source}`}>
        โ {link.source} <Badge>{link.type}</Badge>
      </Link>
    ))}
  </section>
)}
```

### ะจะฐะณ 3: ะะฑะฝะพะฒะธัั TypeScript ัะธะฟั

**ะัะปะพ**:
```typescript
interface AiItem {
  id: string;
  l1_deps: string[];
  // ...
}
```

**ะกัะฐะปะพ**:
```typescript
interface L1LinkIn {
  source: string;
  type: string;
}

interface L1Link {
  target: string;
  type: string;
}

interface AiItem {
  id: string;
  l1_in: L1LinkIn[];
  l1_out: L1Link[];
  // ...
}
```

---

## ะะฐััะพะฝัััะต ัะฝะดะฟะพะธะฝัั

| ะญะฝะดะฟะพะธะฝั | ะะทะผะตะฝะตะฝะธั |
|----------|-----------|
| `GET /api/items` | ะะพะทะฒัะฐัะฐะตั `l1_in` ะธ `l1_out` ะฒะผะตััะพ `l1_deps` |
| `GET /api/items/:id` | ะะพะทะฒัะฐัะฐะตั `l1_in` ะธ `l1_out` ะฒะผะตััะพ `l1_deps` |
| `GET /api/graph` | ะัะฟะพะปัะทัะตั `l1_out` ะดะปั ะฟะพัััะพะตะฝะธั ะณัะฐัะฐ |

---

## ะะฑัะฐัะฝะฐั ัะพะฒะผะตััะธะผะพััั

โ๏ธ **Breaking change!**

- ะะพะปะต `l1_deps` ะฑะพะปััะต ะฝะต ัััะตััะฒัะตั ะฒ API ะพัะฒะตัะฐั
- `l1_in` ะธ `l1_out` ัะตะฟะตัั ะผะฐััะธะฒั **ะพะฑัะตะบัะพะฒ**, ะฝะต ัััะพะบ
- ะะพะด `item.l1_out[0]` ะฒะตัะฝัั ะพะฑัะตะบั `{target: "...", type: "..."}`, ะฝะต ัััะพะบั
- ะะปั ะฟะพะปััะตะฝะธั target: `item.l1_out[0].target`
- ะะปั ะฟะพะปััะตะฝะธั ัะธะฟะฐ: `item.l1_out[0].type`

ะัะปะธ ะฒะฐั ะบะพะด ะพะฑัะฐัะฐะตััั ะบ `item.l1_deps` ะธะปะธ ะพะถะธะดะฐะตั ัััะพะบะธ ะฒ `l1_in`/`l1_out`, ะพะฝ ัะปะพะผะฐะตััั. ะะฑัะทะฐัะตะปัะฝะพ ะพะฑะฝะพะฒะธัะต ะฒัะต ะผะตััะฐ ะธัะฟะพะปัะทะพะฒะฐะฝะธั.

---

## ะัะธะผะตัั ะฒะธะทัะฐะปะธะทะฐัะธะธ

### ะะฐััะพัะบะฐ ัะปะตะผะตะฝัะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ carl_auct.calcPriority          โ
โ [function] SQL                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ะะฐะฒะธัะธะผะพััะธ (โ):                โ
โ   โ carl_auct.auction           โ
โ   โ carl_auct._getAuctObject    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ะัะฟะพะปัะทัะตััั ะฒ (โ):             โ
โ   โ carl_auct.processAuction    โ
โ   โ carl_auct.runBatch          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะัะฐั ะทะฐะฒะธัะธะผะพััะตะน

```
func1 โโโ func2
  โ         โ
  โ         โ
func3 โโโ func4
```

---

## ะะฐะฟะฟะธะฝะณ ัะธะฟะพะฒ ะดะปั UI

```typescript
const typeLabels: Record<string, string> = {
  calls: 'ะัะทัะฒะฐะตั',
  reads_from: 'ะงะธัะฐะตั ะธะท',
  updates: 'ะะฑะฝะพะฒะปัะตั',
  inserts_into: 'ะััะฐะฒะปัะตั ะฒ',
  reads_column: 'ะงะธัะฐะตั ะบะพะปะพะฝะบั',
  updates_column: 'ะะฑะฝะพะฒะปัะตั ะบะพะปะพะฝะบั',
  inserts_column: 'ะััะฐะฒะปัะตั ะฒ ะบะพะปะพะฝะบั',
  imports: 'ะะผะฟะพััะธััะตั',
  depends_on: 'ะะฐะฒะธัะธั ะพั'
};

const typeIcons: Record<string, string> = {
  calls: '๐',
  reads_from: '๐',
  updates: 'โ๏ธ',
  inserts_into: 'โ',
  reads_column: '๐',
  updates_column: '๐',
  inserts_column: '๐ฅ',
  imports: '๐ฆ',
  depends_on: '๐'
};
```

## ะััะฟะฟะธัะพะฒะบะฐ ะฟะพ ัะธะฟั ัะฒัะทะธ

```typescript
// ะััะฟะฟะธััะตะผ l1_out ะฟะพ ัะธะฟั
const grouped = item.l1_out.reduce((acc, link) => {
  if (!acc[link.type]) acc[link.type] = [];
  acc[link.type].push(link.target);
  return acc;
}, {} as Record<string, string[]>);

// ะัะพะฑัะฐะถะตะฝะธะต
{Object.entries(grouped).map(([type, targets]) => (
  <section key={type}>
    <h4>{typeLabels[type] || type}</h4>
    {targets.map(t => <Link key={t} to={`/items/${t}`}>{t}</Link>)}
  </section>
))}
```

## ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะตะบะพะผะตะฝะดะฐัะธะธ

1. **ะััััะต ะผะฐััะธะฒั**: ะะฑะฐ ะฟะพะปั ะฒัะตะณะดะฐ ะฟัะธัััััะฒััั ะฒ ะพัะฒะตัะต (ะผะพะณัั ะฑััั ะฟััััะผะธ ะผะฐััะธะฒะฐะผะธ `[]`)

2. **ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั**: ะะปั ะฑะพะปััะธั ัะฟะธัะบะพะฒ ะธัะฟะพะปัะทัะนัะต ะฒะธัััะฐะปะธะทะฐัะธั ะธะปะธ ะฟะฐะณะธะฝะฐัะธั

3. **ะคะธะปัััะฐัะธั**: ะะพะถะฝะพ ะดะพะฑะฐะฒะธัั ัะธะปัััั ะดะปั ะฟะพะบะฐะทะฐ ัะพะปัะบะพ ะฒัะพะดััะธั ะธะปะธ ัะพะปัะบะพ ะธััะพะดััะธั ัะฒัะทะตะน, ะฐ ัะฐะบะถะต ะฟะพ ัะธะฟะฐะผ ัะฒัะทะตะน

4. **ะะพะธัะบ**: ะะตะฐะปะธะทัะนัะต ะฟะพะธัะบ ะฟะพ `l1_in` ะธ `l1_out` ะดะปั ะฑััััะพะณะพ ะฝะฐัะพะถะดะตะฝะธั ะทะฐะฒะธัะธะผะพััะตะน

5. **ะะธะทัะฐะปะธะทะฐัะธั**: ะัะฟะพะปัะทัะนัะต ัะฐะทะฝัะต ัะฒะตัะฐ/ะธะบะพะฝะบะธ ะดะปั `l1_in` ะธ `l1_out`, ะฐ ัะฐะบะถะต ะดะปั ัะฐะทะฝัั ัะธะฟะพะฒ ัะฒัะทะตะน

6. **ะััะฟะฟะธัะพะฒะบะฐ**: ะััะฟะฟะธััะนัะต ัะฒัะทะธ ะฟะพ ัะธะฟั ะดะปั ะปัััะตะน ัะธัะฐะตะผะพััะธ

---

## ะะพะฟัะพัั ะธ ะฟะพะดะดะตัะถะบะฐ

ะัะธ ะฒะพะทะฝะธะบะฝะพะฒะตะฝะธะธ ะฟัะพะฑะปะตะผ ั ะผะธะณัะฐัะธะตะน ะพะฑัะฐัะฐะนัะตัั ะบ ะบะพะผะฐะฝะดะต ัะฐะทัะฐะฑะพัะบะธ API.

ะะพัะปะตะดะฝะตะต ะพะฑะฝะพะฒะปะตะฝะธะต: 2026-01-22
