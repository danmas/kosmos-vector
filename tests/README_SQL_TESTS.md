# Тесты для SQL Векторизации

Этот набор тестов предназначен для проверки функциональности SQL векторизации в LangChain RAG демо с PostgreSQL.

## Описание тестов

### 1. Тест базовой SQL векторизации (Уровень 0)

Файл: `test_sql_vectorization.js`

Проверяет следующую функциональность:
- Наличие тестового SQL-файла
- API для векторизации SQL-объектов (endpoint `/vectorize-sql`)
- Разбиение SQL-файла на отдельные объекты
- Автоматическое определение типов объектов (таблицы, функции, представления)
- Правильное извлечение имен объектов (s_name, full_name, h_name)

### 2. Тест для уровней SQL-объектов (Уровни 1 и 2)

Файл: `test_sql_vectorization_levels.js`

Проверяет следующую функциональность:
- Создание чанков уровня 1 (связи) для SQL-объектов
- Создание чанков уровня 2 (логика) для SQL-объектов
- API для сохранения чанков уровней (endpoint `/save-level-chunk-db`)
- Получение шаблонов из конфигурации API

## Подготовка

Перед запуском тестов убедитесь, что:

1. Сервер запущен: `npm start`
2. Установлены все зависимости: `npm install`

## Тестовые данные

Тесты используют файл `docs/manual_itest_carl_tables.sql`, который содержит образцы SQL объектов:
- Таблицы
- Функции
- Представления (Views)
- Процедуры
- Триггеры
- Индексы

## Запуск тестов

Запуск тестов базовой векторизации:
```bash
npm run test-sql-vectorization
```

Запуск тестов для уровней SQL-объектов:
```bash
npm run test-sql-levels
```

> **Важно**: Тесты для уровней SQL-объектов следует запускать только после успешного выполнения базовых тестов, так как они зависят от наличия векторизованных объектов уровня 0.

## Параметры тестов

Тесты используют следующие параметры:
- SQL файл: `manual_itest_carl_tables.sql`
- Код контекста: `CARL_TEST_1`
- Схема по умолчанию: `aaaaa`

## Результаты тестов

Успешное выполнение тестов будет отмечено зелеными сообщениями ✓.
В случае ошибок, будет выведен подробный лог с информацией о проблеме.

## Просмотр чанков

После запуска тестов вы можете просмотреть созданные чанки через API:

```bash
curl http://localhost:3005/file-chunks/manual_itest_carl_tables.sql
```

Либо через веб-интерфейс, открыв в браузере:
http://localhost:3005

И перейдя к файлу `manual_itest_carl_tables.sql` в списке документов. 